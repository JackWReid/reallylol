#!/bin/bash
set -euo pipefail

echo "Running pre-commit checks..."

# 1. Validate frontmatter on staged content files
staged_content=$(git diff --cached --name-only --diff-filter=ACM -- 'content/**/*.md' || true)
if [ -n "$staged_content" ]; then
    echo "  Validating frontmatter..."
    echo "$staged_content" | python3 scripts/validate-frontmatter.py
else
    echo "  No staged content files to validate."
fi

# 2. Build and run htmltest (if installed)
if command -v htmltest &> /dev/null; then
    echo "  Building site..."
    hugo --quiet
    echo "  Running htmltest..."
    htmltest
else
    echo "  Skipping htmltest (not installed, run: brew install htmltest)"
fi

echo "Pre-commit checks passed."
