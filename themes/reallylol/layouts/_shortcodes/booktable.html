{{ $scratch := newScratch }}

{{ $data := "nil" }}

{{ $key := .Get "key" }}
{{ $scratch.Set "limit" (.Get "limit" | default 10000) }}

{{ if eq $key "read" }}
  {{ $data = first ($scratch.Get "limit") $.Site.Data.books.read }}
{{ else if eq $key "reading" }}
  {{ $data = first ($scratch.Get "limit") $.Site.Data.books.reading }}
{{ else if eq $key "toread" }}
  {{ $data = first ($scratch.Get "limit") $.Site.Data.books.toread }}
{{ end }}

<ul class="book-grid book-grid--fullwidth" data-paginate="true">
  {{ range $index, $item := $data }}
  {{ $book := $item }}
  <li class="book-card" data-item>
    <div class="book-card__cover-frame">
      {{ if $book.image_url }}
        {{ if lt $index 24 }}
          <img src="{{ $book.image_url }}" alt="Cover of {{ $book.title }}" loading="lazy" class="book-card__cover" />
        {{ else }}
          <img data-src="{{ $book.image_url }}" alt="Cover of {{ $book.title }}" loading="lazy" class="book-card__cover" data-lazy-image />
        {{ end }}
      {{ else }}
        {{ with resources.Get "img/layout/no-book-cover.jpg" }}
          {{ $fallback := .Resize "800x" }}
          <img src="{{ $fallback.RelPermalink }}" alt="Cover of {{ $book.title }}" loading="lazy" class="book-card__cover" />
        {{ end }}
      {{ end }}
    </div>
    <div class="book-card__meta">
      <h3 class="book-card__title">{{ .title }}</h3>
      <div class="book-card__author">{{ .author }}</div>
      <div class="book-card__date">{{ dateFormat "Jan 2, 2006" .date_updated }}</div>
    </div>
  </li>
  {{ end }}
</ul>
<div class="pagination-controls" data-pagination-controls style="display: none;">
  <button type="button" class="pagination-controls__button pagination-controls__button--prev" data-pagination-prev aria-label="Previous page">Previous</button>
  <span class="pagination-controls__info" data-pagination-info></span>
  <button type="button" class="pagination-controls__button pagination-controls__button--next" data-pagination-next aria-label="Next page">Next</button>
</div>
